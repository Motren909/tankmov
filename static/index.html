<!DOCTYPE html>
<html>
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="/static/css/bootstrap.min.css">

<title>tankmov</title>

<link rel="icon" href="/static/tank200.png" type="image/x-icon">  <!-- 添加个图标装作很正式的样子~~~ -->
<link rel="shortcut icon" href="/static/tank200.png" type="image/x-icon">

<style>
    .main {
        max-width: 800px;
        margin: 10px auto 0 auto;
        align-self: center;
        padding-left: 10px;
        padding-right: 10px;
    }
    .basic-button {
        height: 60px;
    }
</style>

</head>
<body>
<div class="main">
    <div>
        <h1>tankmov controller</h1>
        <button type="button" class="btn btn-primary basic-button" onclick="setMode('PID');">PID mode</button>
        <button type="button" class="btn btn-warning basic-button" onclick="setMode('PWM');">PWM mode</button>
        <button type="button" class="btn btn-success basic-button" onclick="sync();" style="width:60px; float: right;">Sync</button>
    </div>
    <hr style="filter: alpha(opacity=100,finishopacity=0,style=3)" width="80%" color=#987cb9 SIZE=3>
    <div>
        Last Sync: <strong id="lastsync">UNKNOWN</strong><br/>
        Current Mode: <strong id="mode">UNKNOWN</strong><br/>
        Free Heap: <strong id="heap">UNKNOWN</strong><br/>
        Current SSID: <strong id="ssid">UNKNOWN</strong><br/>
        Time millis: <strong id="millis">UNKNOWN</strong><br/>
    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
    
<script>
    
    function updateView(settings) {
        console.log(settings);
        let d = new Date();
        $('#lastsync').html(d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds() + "." + d.getMilliseconds());
        let arr = ['mode', 'heap', 'ssid', 'millis'];
        for (let i in arr) {
            let id = arr[i];
            if (id in settings) $('#' + id).html(settings[id]);
        }
    }
    function sync() {
        $.get("sync", function(result) {
            updateView(result);
        });
    }
    function setMode(mode) {
        $.post("setMode", {
            mode: mode
        }, function(result) {
            updateView(result);
        });
    }

    Date.prototype.Format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1, 
            "d+": this.getDate(), 
            "H+": this.getHours(),  
            "m+": this.getMinutes(),  
            "s+": this.getSeconds(), 
            "q+": Math.floor((this.getMonth() + 3) / 3), 
            "S": this.getMilliseconds()  
        };
        var year = this.getFullYear();
        var yearstr = year + '';
        yearstr = yearstr.length >= 4 ? yearstr : '0000'.substr(0, 4 - yearstr.length) + yearstr;
        
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (yearstr + "").substr(4 - RegExp.$1.length));
        for (var k in o)
        if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }
    $(sync);  // when the file is loaded, call sync

</script>
</body>
</html>


